<!DOCTYPE html>
<!-- saved from url=(0042)https://threejs.org/manual/en/shadows.html -->
<html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    
    <title>Shadows</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@threejs">
    <meta name="twitter:title" content="Three.js â€“ Shadows">
    <meta property="og:image" content="https://threejs.org/files/share.png">
    <link rel="shortcut icon" href="https://threejs.org/files/favicon_white.ico" media="(prefers-color-scheme: dark)">
    <link rel="shortcut icon" href="https://threejs.org/files/favicon.ico" media="(prefers-color-scheme: light)">

    <link rel="stylesheet" href="./lesson.css">
    <link rel="stylesheet" href="./lang.css">
  </head>
  <body style="overflow: hidden;">
    <div class="container">
      <div class="lesson-title">
        <h1>Shadows</h1>
      </div>
      <div class="lesson">
        <div class="lesson-main">
          <p>This article is part of a series of articles about three.js. The
first article is <a href="https://threejs.org/manual/en/fundamentals.html">three.js fundamentals</a>. If
you haven't read that yet and you're new to three.js you might want to
consider starting there. The
<a href="https://threejs.org/manual/en/cameras.html">previous article was about cameras</a> which is
important to have read before you read this article as well as
the <a href="https://threejs.org/manual/en/lights.html">article before that one about lights</a>.</p>
<p>Shadows on computers can be a complicated topic. There are various
solutions and all of them have tradeoffs including the solutions
available in three.js.</p>
<p>Three.js by default uses <em>shadow maps</em>. The way a shadow map works
is, <em>for every light that casts shadows all objects marked to cast
shadows are rendered from the point of view of the light</em>. <strong>READ THAT
AGAIN!</strong> and let it sink in.</p>
<p>In other words, if you have 20 objects, and 5 lights, and
all 20 objects are casting shadows and all 5 lights are casting
shadows then your entire scene will be drawn 6 times. All 20 objects
will be drawn for light #1, then all 20 objects will be drawn for
light #2, then #3, etc and finally the actual scene will be drawn
using data from the first 5 renders.</p>
<p>It gets worse, if you have a point light casting shadows the scene
has to be drawn 6 times just for that light!</p>
<p>For these reasons it's common to find other solutions than to have
a bunch of lights all generating shadows. One common solution
is to have multiple lights but only one directional light generating
shadows.</p>
<p>Yet another solution is to use lightmaps and or ambient occlusion maps
to pre-compute the effects of lighting offline. This results in static
lighting or static lighting hints but at least it's fast. We'll
cover both of those in another article.</p>
<p>Another solution is to use fake shadows. Make a plane, put a grayscale
texture in the plane that approximates a shadow,
draw it above the ground below your object.</p>
<p>For example let's use this texture as a fake shadow</p>
<div class="threejs_center"><img src="./roundshadow.png"></div>

<p>We'll use some of the code from <a href="https://threejs.org/manual/en/cameras.html">the previous article</a>.</p>
<p>Let's set the background color to white.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> scene </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Scene</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">scene</span><span class="pun">.</span><span class="pln">background </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Color</span><span class="pun">(</span><span class="str">'white'</span><span class="pun">);</span></li></ul></pre>
<p>Then we'll setup the same checkerboard ground but this time it's using
a <a href="https://threejs.org/docs/#api/en/materials/MeshBasicMaterial"><code class="notranslate" translate="no">MeshBasicMaterial</code></a> as we don't need lighting for the ground.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class="lineadded"><span class="kwd">const</span><span class="pln"> loader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">TextureLoader</span><span class="pun">();</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> planeSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">40</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class="linedeleted"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> loader </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">TextureLoader</span><span class="pun">();</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> texture </span><span class="pun">=</span><span class="pln"> loader</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="str">'resources/images/checker.png'</span><span class="pun">);</span></li><li class=""><span class="pln">  texture</span><span class="pun">.</span><span class="pln">wrapS </span><span class="pun">=</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">RepeatWrapping</span><span class="pun">;</span></li><li class=""><span class="pln">  texture</span><span class="pun">.</span><span class="pln">wrapT </span><span class="pun">=</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">RepeatWrapping</span><span class="pun">;</span></li><li class=""><span class="pln">  texture</span><span class="pun">.</span><span class="pln">magFilter </span><span class="pun">=</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">NearestFilter</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> repeats </span><span class="pun">=</span><span class="pln"> planeSize </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  texture</span><span class="pun">.</span><span class="pln">repeat</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="pln">repeats</span><span class="pun">,</span><span class="pln"> repeats</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> planeGeo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PlaneGeometry</span><span class="pun">(</span><span class="pln">planeSize</span><span class="pun">,</span><span class="pln"> planeSize</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> planeMat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshBasicMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">    map</span><span class="pun">:</span><span class="pln"> texture</span><span class="pun">,</span></li><li class=""><span class="pln">    side</span><span class="pun">:</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DoubleSide</span><span class="pun">,</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class="lineadded"><span class="pln">  planeMat</span><span class="pun">.</span><span class="pln">color</span><span class="pun">.</span><span class="pln">setRGB</span><span class="pun">(</span><span class="lit">1.5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.5</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">planeGeo</span><span class="pun">,</span><span class="pln"> planeMat</span><span class="pun">);</span></li><li class=""><span class="pln">  mesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI </span><span class="pun">*</span><span class="pln"> </span><span class="pun">-.</span><span class="lit">5</span><span class="pun">;</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>Note we're setting the color to <code class="notranslate" translate="no">1.5, 1.5, 1.5</code>. This will multiply the checkerboard
texture's colors by 1.5, 1.5, 1.5. Since the texture's colors are 0x808080 and 0xC0C0C0
which is medium gray and light gray, multiplying them by 1.5 will give us a white and
light grey checkerboard.</p>
<p>Let's load the shadow texture</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> shadowTexture </span><span class="pun">=</span><span class="pln"> loader</span><span class="pun">.</span><span class="pln">load</span><span class="pun">(</span><span class="str">'resources/images/roundshadow.png'</span><span class="pun">);</span></li></ul></pre>
<p>and make an array to remember each sphere and associated objects.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sphereShadowBases </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[];</span></li></ul></pre>
<p>Then we'll make a sphere geometry</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> sphereRadius </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="kwd">const</span><span class="pln"> sphereWidthDivisions </span><span class="pun">=</span><span class="pln"> </span><span class="lit">32</span><span class="pun">;</span></li><li class=""><span class="kwd">const</span><span class="pln"> sphereHeightDivisions </span><span class="pun">=</span><span class="pln"> </span><span class="lit">16</span><span class="pun">;</span></li><li class=""><span class="kwd">const</span><span class="pln"> sphereGeo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SphereGeometry</span><span class="pun">(</span><span class="pln">sphereRadius</span><span class="pun">,</span><span class="pln"> sphereWidthDivisions</span><span class="pun">,</span><span class="pln"> sphereHeightDivisions</span><span class="pun">);</span></li></ul></pre>
<p>And a plane geometry for the fake shadow</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> planeSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="kwd">const</span><span class="pln"> shadowGeo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PlaneGeometry</span><span class="pun">(</span><span class="pln">planeSize</span><span class="pun">,</span><span class="pln"> planeSize</span><span class="pun">);</span></li></ul></pre>
<p>Now we'll make a bunch of spheres. For each sphere we'll create a <code class="notranslate" translate="no">base</code>
<a href="https://threejs.org/docs/#api/en/core/Object3D"><code class="notranslate" translate="no">THREE.Object3D</code></a> and we'll make both the shadow plane mesh and the sphere mesh
children of the base. That way if we move the base both the sphere and the shadow
will move. We need to put the shadow slightly above the ground to prevent z-fighting.
We also set <code class="notranslate" translate="no">depthWrite</code> to false so that the shadows don't mess each other up.
We'll go over both of these issues in <a href="https://threejs.org/manual/en/transparency.html">another article</a>.
The shadow is a <a href="https://threejs.org/docs/#api/en/materials/MeshBasicMaterial"><code class="notranslate" translate="no">MeshBasicMaterial</code></a> because it doesn't need lighting.</p>
<p>We make each sphere a different hue and then save off the base, the sphere mesh,
the shadow mesh and the initial y position of each sphere.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> numSpheres </span><span class="pun">=</span><span class="pln"> </span><span class="lit">15</span><span class="pun">;</span></li><li class=""><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="pln">let i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> numSpheres</span><span class="pun">;</span><span class="pln"> </span><span class="pun">++</span><span class="pln">i</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// make a base for the shadow and the sphere</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// so they move together.</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> base </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Object3D</span><span class="pun">();</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">base</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// add the shadow to the base</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// note: we make a new material for each sphere</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// so we can set that sphere's material transparency</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// separately.</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> shadowMat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshBasicMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">    map</span><span class="pun">:</span><span class="pln"> shadowTexture</span><span class="pun">,</span></li><li class=""><span class="pln">    transparent</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">,</span><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// so we can see the ground</span></li><li class=""><span class="pln">    depthWrite</span><span class="pun">:</span><span class="pln"> </span><span class="kwd">false</span><span class="pun">,</span><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// so we don't have to sort</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> shadowMesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">shadowGeo</span><span class="pun">,</span><span class="pln"> shadowMat</span><span class="pun">);</span></li><li class=""><span class="pln">  shadowMesh</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0.001</span><span class="pun">;</span><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// so we're above the ground slightly</span></li><li class=""><span class="pln">  shadowMesh</span><span class="pun">.</span><span class="pln">rotation</span><span class="pun">.</span><span class="pln">x </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI </span><span class="pun">*</span><span class="pln"> </span><span class="pun">-.</span><span class="lit">5</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> shadowSize </span><span class="pun">=</span><span class="pln"> sphereRadius </span><span class="pun">*</span><span class="pln"> </span><span class="lit">4</span><span class="pun">;</span></li><li class=""><span class="pln">  shadowMesh</span><span class="pun">.</span><span class="pln">scale</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="pln">shadowSize</span><span class="pun">,</span><span class="pln"> shadowSize</span><span class="pun">,</span><span class="pln"> shadowSize</span><span class="pun">);</span></li><li class=""><span class="pln">  base</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">shadowMesh</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// add the sphere to the base</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> i </span><span class="pun">/</span><span class="pln"> numSpheres</span><span class="pun">;</span><span class="pln">   </span><span class="com translate yestranslate" translate="yes">// goes from 0 to 1 as we iterate the spheres.</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sphereMat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">();</span></li><li class=""><span class="pln">  sphereMat</span><span class="pun">.</span><span class="pln">color</span><span class="pun">.</span><span class="pln">setHSL</span><span class="pun">(</span><span class="pln">u</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">.</span><span class="lit">75</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> sphereMesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">sphereGeo</span><span class="pun">,</span><span class="pln"> sphereMat</span><span class="pun">);</span></li><li class=""><span class="pln">  sphereMesh</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> sphereRadius </span><span class="pun">+</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class=""><span class="pln">  base</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">sphereMesh</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// remember all 3 plus the y position</span></li><li class=""><span class="pln">  sphereShadowBases</span><span class="pun">.</span><span class="pln">push</span><span class="pun">({</span><span class="pln">base</span><span class="pun">,</span><span class="pln"> sphereMesh</span><span class="pun">,</span><span class="pln"> shadowMesh</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">:</span><span class="pln"> sphereMesh</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">y</span><span class="pun">});</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>We setup 2 lights. One is a <a href="https://threejs.org/docs/#api/en/lights/HemisphereLight"><code class="notranslate" translate="no">HemisphereLight</code></a> with the intensity set to 2 to really
brighten things up.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> skyColor </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xB1E1FF</span><span class="pun">;</span><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// light blue</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> groundColor </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xB97A20</span><span class="pun">;</span><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// brownish orange</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> intensity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">HemisphereLight</span><span class="pun">(</span><span class="pln">skyColor</span><span class="pun">,</span><span class="pln"> groundColor</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>The other is a <a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a> so the spheres get some definition</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> color </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0xFFFFFF</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> intensity </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DirectionalLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class=""><span class="pln">  light</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">10</span><span class="pun">,</span><span class="pln"> </span><span class="lit">5</span><span class="pun">);</span></li><li class=""><span class="pln">  light</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(-</span><span class="lit">5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">target</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>It would render as is but let's animate there spheres.
For each sphere, shadow, base set we move the base in the xz plane, we
move the sphere up and down using <a href="https://threejs.org/docs/#api/en/math/Math.abs(Math.sin(time))"><code class="notranslate" translate="no">Math.abs(Math.sin(time))</code></a>
which gives us a bouncy animation. And, we also set the shadow material's
opacity so that as each sphere goes higher its shadow fades out.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> render</span><span class="pun">(</span><span class="pln">time</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  time </span><span class="pun">*=</span><span class="pln"> </span><span class="lit">0.001</span><span class="pun">;</span><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// convert to seconds</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="pun">...</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  sphereShadowBases</span><span class="pun">.</span><span class="pln">forEach</span><span class="pun">((</span><span class="pln">sphereShadowBase</span><span class="pun">,</span><span class="pln"> ndx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> </span><span class="pun">{</span><span class="pln">base</span><span class="pun">,</span><span class="pln"> sphereMesh</span><span class="pun">,</span><span class="pln"> shadowMesh</span><span class="pun">,</span><span class="pln"> y</span><span class="pun">}</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> sphereShadowBase</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// u is a value that goes from 0 to 1 as we iterate the spheres</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> u </span><span class="pun">=</span><span class="pln"> ndx </span><span class="pun">/</span><span class="pln"> sphereShadowBases</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// compute a position for the base. This will move</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// both the sphere and its shadow</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> speed </span><span class="pun">=</span><span class="pln"> time </span><span class="pun">*</span><span class="pln"> </span><span class="pun">.</span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> angle </span><span class="pun">=</span><span class="pln"> speed </span><span class="pun">+</span><span class="pln"> u </span><span class="pun">*</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">PI </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="pun">(</span><span class="pln">ndx </span><span class="pun">%</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">?</span><span class="pln"> </span><span class="lit">1</span><span class="pln"> </span><span class="pun">:</span><span class="pln"> </span><span class="pun">-</span><span class="lit">1</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> radius </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">speed </span><span class="pun">-</span><span class="pln"> ndx</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">10</span><span class="pun">;</span></li><li class=""><span class="pln">    base</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">cos</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> radius</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">)</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> radius</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// yOff is a value that goes from 0 to 1</span></li><li class=""><span class="pln">    </span><span class="kwd">const</span><span class="pln"> yOff </span><span class="pun">=</span><span class="pln"> </span><span class="typ">Math</span><span class="pun">.</span><span class="pln">abs</span><span class="pun">(</span><span class="typ">Math</span><span class="pun">.</span><span class="pln">sin</span><span class="pun">(</span><span class="pln">time </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">+</span><span class="pln"> ndx</span><span class="pun">));</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// move the sphere up and down</span></li><li class=""><span class="pln">    sphereMesh</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="pln">y </span><span class="pun">=</span><span class="pln"> y </span><span class="pun">+</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MathUtils</span><span class="pun">.</span><span class="pln">lerp</span><span class="pun">(-</span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> yOff</span><span class="pun">);</span></li><li class=""><span class="pln">    </span><span class="com translate yestranslate" translate="yes">// fade the shadow as the sphere goes up</span></li><li class=""><span class="pln">    shadowMesh</span><span class="pun">.</span><span class="pln">material</span><span class="pun">.</span><span class="pln">opacity </span><span class="pun">=</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MathUtils</span><span class="pun">.</span><span class="pln">lerp</span><span class="pun">(</span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="pun">.</span><span class="lit">25</span><span class="pun">,</span><span class="pln"> yOff</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pln">  </span><span class="pun">...</span></li></ul></pre>
<p>And here's 15 kind of bouncing balls.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="./editor.html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-fake.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>In some apps it's common to use a round or oval shadow for everything but
of course you could also use different shaped shadow textures. You might also
give the shadow a harder edge. A good example of using this type
of shadow is <a href="https://www.google.com/search?tbm=isch&amp;q=animal+crossing+pocket+camp+screenshots">Animal Crossing Pocket Camp</a>
where you can see each character has a simple round shadow. It's effective and cheap.
<a href="https://www.google.com/search?q=monument+valley+screenshots&amp;tbm=isch">Monument Valley</a>
appears to also use this kind of shadow for the main character.</p>
<p>So, moving on to shadow maps, there are 3 lights which can cast shadows. The <a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a>,
the <a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a>, and the <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a>.</p>
<p>Let's start with the <a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a> with the helper example from <a href="https://threejs.org/manual/en/lights.html">the lights article</a>.</p>
<p>The first thing we need to do is turn on shadows in the renderer.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> renderer </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">WebGLRenderer</span><span class="pun">({</span><span class="pln">canvas</span><span class="pun">});</span></li><li class="lineadded"><span class="pln">renderer</span><span class="pun">.</span><span class="pln">shadowMap</span><span class="pun">.</span><span class="pln">enabled </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li></ul></pre>
<p>Then we also need to tell the light to cast a shadow</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DirectionalLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">light</span><span class="pun">.</span><span class="pln">castShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li></ul></pre>
<p>We also need to go to each mesh in the scene and decide if it should
both cast shadows and/or receive shadows.</p>
<p>Let's make the plane (the ground) only receive shadows since we don't
really care what happens underneath.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">planeGeo</span><span class="pun">,</span><span class="pln"> planeMat</span><span class="pun">);</span></li><li class=""><span class="pln">mesh</span><span class="pun">.</span><span class="pln">receiveShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li></ul></pre>
<p>For the cube and the sphere let's have them both receive and cast shadows</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">cubeGeo</span><span class="pun">,</span><span class="pln"> cubeMat</span><span class="pun">);</span></li><li class=""><span class="pln">mesh</span><span class="pun">.</span><span class="pln">castShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class=""><span class="pln">mesh</span><span class="pun">.</span><span class="pln">receiveShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pun">...</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">sphereGeo</span><span class="pun">,</span><span class="pln"> sphereMat</span><span class="pun">);</span></li><li class=""><span class="pln">mesh</span><span class="pun">.</span><span class="pln">castShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class=""><span class="pln">mesh</span><span class="pun">.</span><span class="pln">receiveShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li></ul></pre>
<p>And then we run it.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="./editor(1).html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-directional-light.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>What happened? Why are parts of the shadows missing?</p>
<p>The reason is shadow maps are created by rendering the scene from the point
of view of the light. In this case there is a camera at the <a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a>
that is looking at its target. Just like <a href="https://threejs.org/manual/en/cameras.html">the camera's we previously covered</a>
the light's shadow camera defines an area inside of which
the shadows get rendered. In the example above that area is too small.</p>
<p>In order to visualize that area we can get the light's shadow camera and add
a <a href="https://threejs.org/docs/#api/en/helpers/CameraHelper"><code class="notranslate" translate="no">CameraHelper</code></a> to the scene.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> cameraHelper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">CameraHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">);</span></li><li class=""><span class="pln">scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">cameraHelper</span><span class="pun">);</span></li></ul></pre>
<p>And now you can see the area for which shadows are cast and received.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="./editor(2).html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-directional-light-with-camera-helper.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>Adjust the target x value back and forth and it should be pretty clear that only
what's inside the light's shadow camera box is where shadows are drawn.</p>
<p>We can adjust the size of that box by adjusting the light's shadow camera.</p>
<p>Let's add some GUI setting to adjust the light's shadow camera box. Since a
<a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a> represents light all going in a parallel direction, the
<a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a> uses an <a href="https://threejs.org/docs/#api/en/cameras/OrthographicCamera"><code class="notranslate" translate="no">OrthographicCamera</code></a> for its shadow camera.
We went over how an <a href="https://threejs.org/docs/#api/en/cameras/OrthographicCamera"><code class="notranslate" translate="no">OrthographicCamera</code></a> works in <a href="https://threejs.org/manual/en/cameras.html">the previous article about cameras</a>.</p>
<p>Recall an <a href="https://threejs.org/docs/#api/en/cameras/OrthographicCamera"><code class="notranslate" translate="no">OrthographicCamera</code></a> defines
its box or <em>view frustum</em> by its <code class="notranslate" translate="no">left</code>, <code class="notranslate" translate="no">right</code>, <code class="notranslate" translate="no">top</code>, <code class="notranslate" translate="no">bottom</code>, <code class="notranslate" translate="no">near</code>, <code class="notranslate" translate="no">far</code>,
and <code class="notranslate" translate="no">zoom</code> properties.</p>
<p>Again let's make a helper class for the lil-gui. We'll make a <code class="notranslate" translate="no">DimensionGUIHelper</code>
that we'll pass an object and 2 properties. It will present one property that lil-gui
can adjust and in response will set the two properties one positive and one negative.
We can use this to set <code class="notranslate" translate="no">left</code> and <code class="notranslate" translate="no">right</code> as <code class="notranslate" translate="no">width</code> and <code class="notranslate" translate="no">up</code> and <code class="notranslate" translate="no">down</code> as <code class="notranslate" translate="no">height</code>.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">class</span><span class="pln"> </span><span class="typ">DimensionGUIHelper</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  constructor</span><span class="pun">(</span><span class="pln">obj</span><span class="pun">,</span><span class="pln"> minProp</span><span class="pun">,</span><span class="pln"> maxProp</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">obj </span><span class="pun">=</span><span class="pln"> obj</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">minProp </span><span class="pun">=</span><span class="pln"> minProp</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">maxProp </span><span class="pun">=</span><span class="pln"> maxProp</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">  </span><span class="kwd">get</span><span class="pln"> value</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">obj</span><span class="pun">[</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">maxProp</span><span class="pun">]</span><span class="pln"> </span><span class="pun">*</span><span class="pln"> </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pln">  </span><span class="kwd">set</span><span class="pln"> value</span><span class="pun">(</span><span class="pln">v</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">obj</span><span class="pun">[</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">maxProp</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> v </span><span class="pun">/</span><span class="pln">  </span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">    </span><span class="kwd">this</span><span class="pun">.</span><span class="pln">obj</span><span class="pun">[</span><span class="kwd">this</span><span class="pun">.</span><span class="pln">minProp</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> v </span><span class="pun">/</span><span class="pln"> </span><span class="pun">-</span><span class="lit">2</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="pun">}</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>We'll also use the <code class="notranslate" translate="no">MinMaxGUIHelper</code> we created in the <a href="https://threejs.org/manual/en/cameras.html">camera article</a>
to adjust <code class="notranslate" translate="no">near</code> and <code class="notranslate" translate="no">far</code>.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">const</span><span class="pln"> gui </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> GUI</span><span class="pun">();</span></li><li class=""><span class="pln">gui</span><span class="pun">.</span><span class="pln">addColor</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">ColorGUIHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">,</span><span class="pln"> </span><span class="str">'color'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'value'</span><span class="pun">).</span><span class="pln">name</span><span class="pun">(</span><span class="str">'color'</span><span class="pun">);</span></li><li class=""><span class="pln">gui</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">,</span><span class="pln"> </span><span class="str">'intensity'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.01</span><span class="pun">);</span></li><li class="lineadded"><span class="pun">{</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> folder </span><span class="pun">=</span><span class="pln"> gui</span><span class="pun">.</span><span class="pln">addFolder</span><span class="pun">(</span><span class="str">'Shadow Camera'</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">open</span><span class="pun">();</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DimensionGUIHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">,</span><span class="pln"> </span><span class="str">'left'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'right'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'value'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">)</span></li><li class="lineadded"><span class="pln">    </span><span class="pun">.</span><span class="pln">name</span><span class="pun">(</span><span class="str">'width'</span><span class="pun">)</span></li><li class="lineadded"><span class="pln">    </span><span class="pun">.</span><span class="pln">onChange</span><span class="pun">(</span><span class="pln">updateCamera</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="kwd">new</span><span class="pln"> </span><span class="typ">DimensionGUIHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">,</span><span class="pln"> </span><span class="str">'bottom'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'top'</span><span class="pun">),</span><span class="pln"> </span><span class="str">'value'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">100</span><span class="pun">)</span></li><li class="lineadded"><span class="pln">    </span><span class="pun">.</span><span class="pln">name</span><span class="pun">(</span><span class="str">'height'</span><span class="pun">)</span></li><li class="lineadded"><span class="pln">    </span><span class="pun">.</span><span class="pln">onChange</span><span class="pun">(</span><span class="pln">updateCamera</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  </span><span class="kwd">const</span><span class="pln"> minMaxGUIHelper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">MinMaxGUIHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">,</span><span class="pln"> </span><span class="str">'near'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'far'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">minMaxGUIHelper</span><span class="pun">,</span><span class="pln"> </span><span class="str">'min'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">50</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">).</span><span class="pln">name</span><span class="pun">(</span><span class="str">'near'</span><span class="pun">).</span><span class="pln">onChange</span><span class="pun">(</span><span class="pln">updateCamera</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">minMaxGUIHelper</span><span class="pun">,</span><span class="pln"> </span><span class="str">'max'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">50</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">).</span><span class="pln">name</span><span class="pun">(</span><span class="str">'far'</span><span class="pun">).</span><span class="pln">onChange</span><span class="pun">(</span><span class="pln">updateCamera</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">  folder</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">,</span><span class="pln"> </span><span class="str">'zoom'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.01</span><span class="pun">,</span><span class="pln"> </span><span class="lit">1.5</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0.01</span><span class="pun">).</span><span class="pln">onChange</span><span class="pun">(</span><span class="pln">updateCamera</span><span class="pun">);</span></li><li class="lineadded"><span class="pun">}</span></li></ul></pre>
<p>We tell the GUI to call our <code class="notranslate" translate="no">updateCamera</code> function anytime anything changes.
Let's write that function to update the light, the helper for the light, the
light's shadow camera, and the helper showing the light's shadow camera.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="kwd">function</span><span class="pln"> updateCamera</span><span class="pun">()</span><span class="pln"> </span><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// update the light target's matrixWorld because it's needed by the helper</span></li><li class=""><span class="pln">  light</span><span class="pun">.</span><span class="pln">target</span><span class="pun">.</span><span class="pln">updateMatrixWorld</span><span class="pun">();</span></li><li class=""><span class="pln">  helper</span><span class="pun">.</span><span class="pln">update</span><span class="pun">();</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// update the light's shadow camera's projection matrix</span></li><li class=""><span class="pln">  light</span><span class="pun">.</span><span class="pln">shadow</span><span class="pun">.</span><span class="pln">camera</span><span class="pun">.</span><span class="pln">updateProjectionMatrix</span><span class="pun">();</span></li><li class=""><span class="pln">  </span><span class="com translate yestranslate" translate="yes">// and now update the camera helper we're using to show the light's shadow camera</span></li><li class=""><span class="pln">  cameraHelper</span><span class="pun">.</span><span class="pln">update</span><span class="pun">();</span></li><li class=""><span class="pun">}</span></li><li class=""><span class="pln">updateCamera</span><span class="pun">();</span></li></ul></pre>
<p>And now that we've given the light's shadow camera a GUI we can play with the values.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate fullscreen" translate="no" style=" " src="./editor(3).html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-directional-light-with-camera-gui.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>Set the <code class="notranslate" translate="no">width</code> and <code class="notranslate" translate="no">height</code> to about 30 and you can see the shadows are correct
and the areas that need to be in shadow for this scene are entirely covered.</p>
<p>But this brings up the question, why not just set <code class="notranslate" translate="no">width</code> and <code class="notranslate" translate="no">height</code> to some
giant numbers to just cover everything? Set the <code class="notranslate" translate="no">width</code> and <code class="notranslate" translate="no">height</code> to 100
and you might see something like this</p>
<div class="threejs_center"><img src="./low-res-shadow-map.png" style="width: 369px"></div>

<p>What's going on with these low-res shadows?!</p>
<p>This issue is yet another shadow related setting to be aware of.
Shadow maps are textures the shadows get drawn into.
Those textures have a size. The shadow camera's area we set above is stretched
across that size. That means the larger area you set, the more blocky your shadows will
be.</p>
<p>You can set the resolution of the shadow map's texture by setting <code class="notranslate" translate="no">light.shadow.mapSize.width</code>
and <code class="notranslate" translate="no">light.shadow.mapSize.height</code>. They default to 512x512.
The larger you make them the more memory they take and the slower they are to compute so you want
to set them as small as you can and still make your scene work. The same is true with the
light's shadow camera area. Smaller means better looking shadows so make the area as small as you
can and still cover your scene. Be aware that each user's machine has a maximum texture size
allowed which is available on the renderer as <a href="https://threejs.org/docs/#api/en/renderers/WebGLRenderer#capabilities"><code class="notranslate" translate="no">renderer.capabilities.maxTextureSize</code></a>.</p>
<!--
Ok but what about `near` and `far` I hear you thinking. Can we set `near` to 0.00001 and far to `100000000`
-->
<p>Switching to the <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a> the light's shadow camera becomes a <a href="https://threejs.org/docs/#api/en/cameras/PerspectiveCamera"><code class="notranslate" translate="no">PerspectiveCamera</code></a>. Unlike the <a href="https://threejs.org/docs/#api/en/lights/DirectionalLight"><code class="notranslate" translate="no">DirectionalLight</code></a>'s shadow camera
where we could manually set most its settings, <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a>'s shadow camera is controlled by the <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a> itself. The <code class="notranslate" translate="no">fov</code> for the shadow
camera is directly connected to the <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a>'s <code class="notranslate" translate="no">angle</code> setting.
The <code class="notranslate" translate="no">aspect</code> is set automatically based on the size of the shadow map.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class="linedeleted"><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">DirectionalLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class="lineadded"><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SpotLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li></ul></pre>
<p>and we added back in the <code class="notranslate" translate="no">penumbra</code> and <code class="notranslate" translate="no">angle</code> settings
from our <a href="https://threejs.org/manual/en/lights.html">article about lights</a>.</p>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="./editor(4).html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-spot-light-with-camera-gui.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<!--
You can notice, just like the last example if we set the angle high
then the shadow map, the texture is spread over a very large area and
the resolution of our shadows gets really low.

div class="threejs_center"><img src="../resources/images/low-res-shadow-map-spotlight.png" style="width: 344px"></div>

You can increase the size of the shadow map as mentioned above. You can
also blur the result

<div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="/manual/examples/resources/editor.html?url=/manual/examples/shadows-spot-light-with-shadow-radius"></iframe></div>
  <a class="threejs_center" href="/manual/examples/shadows-spot-light-with-shadow-radius" target="_blank">click here to open in a separate window</a>
</div>


-->
<p>And finally there's shadows with a <a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a>. Since a <a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a>
shines in all directions the only relevant settings are <code class="notranslate" translate="no">near</code> and <code class="notranslate" translate="no">far</code>.
Otherwise the <a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a> shadow is effectively 6 <a href="https://threejs.org/docs/#api/en/lights/SpotLight"><code class="notranslate" translate="no">SpotLight</code></a> shadows
each one pointing to the face of a cube around the light. This means
<a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a> shadows are much slower since the entire scene must be
drawn 6 times, one for each direction.</p>
<p>Let's put a box around our scene so we can see shadows on the walls
and ceiling. We'll set the material's <code class="notranslate" translate="no">side</code> property to <code class="notranslate" translate="no">THREE.BackSide</code>
so we render the inside of the box instead of the outside. Like the floor
we'll set it only to receive shadows. Also we'll set the position of the
box so its bottom is slightly below the floor so the floor and the bottom
of the box don't z-fight.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class=""><span class="pun">{</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> cubeSize </span><span class="pun">=</span><span class="pln"> </span><span class="lit">30</span><span class="pun">;</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> cubeGeo </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BoxGeometry</span><span class="pun">(</span><span class="pln">cubeSize</span><span class="pun">,</span><span class="pln"> cubeSize</span><span class="pun">,</span><span class="pln"> cubeSize</span><span class="pun">);</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> cubeMat </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">MeshPhongMaterial</span><span class="pun">({</span></li><li class=""><span class="pln">    color</span><span class="pun">:</span><span class="pln"> </span><span class="str">'#CCC'</span><span class="pun">,</span></li><li class=""><span class="pln">    side</span><span class="pun">:</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">BackSide</span><span class="pun">,</span></li><li class=""><span class="pln">  </span><span class="pun">});</span></li><li class=""><span class="pln">  </span><span class="kwd">const</span><span class="pln"> mesh </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">Mesh</span><span class="pun">(</span><span class="pln">cubeGeo</span><span class="pun">,</span><span class="pln"> cubeMat</span><span class="pun">);</span></li><li class=""><span class="pln">  mesh</span><span class="pun">.</span><span class="pln">receiveShadow </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">true</span><span class="pun">;</span></li><li class=""><span class="pln">  mesh</span><span class="pun">.</span><span class="pln">position</span><span class="pun">.</span><span class="kwd">set</span><span class="pun">(</span><span class="lit">0</span><span class="pun">,</span><span class="pln"> cubeSize </span><span class="pun">/</span><span class="pln"> </span><span class="lit">2</span><span class="pln"> </span><span class="pun">-</span><span class="pln"> </span><span class="lit">0.1</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span></li><li class=""><span class="pln">  scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">mesh</span><span class="pun">);</span></li><li class=""><span class="pun">}</span></li></ul></pre>
<p>And of course we need to switch the light to a <a href="https://threejs.org/docs/#api/en/lights/PointLight"><code class="notranslate" translate="no">PointLight</code></a>.</p>
<pre class="prettyprint showlinemods notranslate lang-js prettyprinted" translate="no" style=""><ul class="modifiedlines"><li class="linedeleted"><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">SpotLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class="lineadded"><span class="kwd">const</span><span class="pln"> light </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PointLight</span><span class="pun">(</span><span class="pln">color</span><span class="pun">,</span><span class="pln"> intensity</span><span class="pun">);</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="pun">....</span></li><li class=""><span class="pln">&nbsp;</span></li><li class=""><span class="com translate yestranslate" translate="yes">// so we can easily see where the point light is</span></li><li class="lineadded"><span class="kwd">const</span><span class="pln"> helper </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> THREE</span><span class="pun">.</span><span class="typ">PointLightHelper</span><span class="pun">(</span><span class="pln">light</span><span class="pun">);</span></li><li class="lineadded"><span class="pln">scene</span><span class="pun">.</span><span class="pln">add</span><span class="pun">(</span><span class="pln">helper</span><span class="pun">);</span></li></ul></pre>
<p></p><div translate="no" class="threejs_example_container notranslate">
  <div><iframe class="threejs_example notranslate" translate="no" style=" " src="./editor(5).html"></iframe></div>
  <a class="threejs_center" href="https://threejs.org/manual/examples/shadows-point-light.html" target="_blank">click here to open in a separate window</a>
</div>

<p></p>
<p>Use the <code class="notranslate" translate="no">position</code> GUI settings to move the light around
and you'll see the shadows fall on all the walls. You can
also adjust <code class="notranslate" translate="no">near</code> and <code class="notranslate" translate="no">far</code> settings and see just like
the other shadows when things are closer than <code class="notranslate" translate="no">near</code> they
no longer receive a shadow and they are further than <code class="notranslate" translate="no">far</code>
they are always in shadow.</p>
<!--
self shadow, shadow acne
-->

        </div>
      </div>
    </div>
  
  <script src="./prettify.js"></script>
  <script src="./lesson.js"></script>




</body></html>